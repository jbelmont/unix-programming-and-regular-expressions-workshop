
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Build Automation Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="building-command-line-applications.html" />
    
    
    <link rel="prev" href="remote-file-sharing-and-file-access.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Unix Programming and Regular Expressions Workshop</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Workshop Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="basics-of-shell-programming.html">
            
                <a href="basics-of-shell-programming.html">
            
                    
                    Basics of Shell Programming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="introduction-to-text-processing.html">
            
                <a href="introduction-to-text-processing.html">
            
                    
                    Introduction to Text Processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="text-searching.html">
            
                <a href="text-searching.html">
            
                    
                    Text Searching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="text-substitution.html">
            
                <a href="text-substitution.html">
            
                    
                    Text Substitution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="filename-expansions-and-globbing.html">
            
                <a href="filename-expansions-and-globbing.html">
            
                    
                    Filename expansions and globbing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="working-with-fields.html">
            
                <a href="working-with-fields.html">
            
                    
                    Working with Fields
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="text-sorting.html">
            
                <a href="text-sorting.html">
            
                    
                    Text Sorting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="arithmetic-operations-and-variables.html">
            
                <a href="arithmetic-operations-and-variables.html">
            
                    
                    Arithmetic Operations and variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="decision-making-and-exit-status.html">
            
                <a href="decision-making-and-exit-status.html">
            
                    
                    Decision Making and Exit Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="looping.html">
            
                <a href="looping.html">
            
                    
                    Looping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="input-and-output.html">
            
                <a href="input-and-output.html">
            
                    
                    Input and Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="command-process-substitution.html">
            
                <a href="command-process-substitution.html">
            
                    
                    Command Process Substitution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="history-substitution.html">
            
                <a href="history-substitution.html">
            
                    
                    History Substitution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="evaluation-order.html">
            
                <a href="evaluation-order.html">
            
                    
                    Evaluation Order
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="subshells.html">
            
                <a href="subshells.html">
            
                    
                    Subshells
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="shell-functions.html">
            
                <a href="shell-functions.html">
            
                    
                    Shell Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="signal-handling.html">
            
                <a href="signal-handling.html">
            
                    
                    Signal Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="working-with-files.html">
            
                <a href="working-with-files.html">
            
                    
                    Working with Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="remote-file-sharing-and-file-access.html">
            
                <a href="remote-file-sharing-and-file-access.html">
            
                    
                    Remote File Sharing and File Access
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.21" data-path="build-automation.html">
            
                <a href="build-automation.html">
            
                    
                    Build Automation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="building-command-line-applications.html">
            
                <a href="building-command-line-applications.html">
            
                    
                    Building Command line applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="shell-login-order.html">
            
                <a href="shell-login-order.html">
            
                    
                    Shell Login Order
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="network-utilities.html">
            
                <a href="network-utilities.html">
            
                    
                    Network Utilities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="shell-security.html">
            
                <a href="shell-security.html">
            
                    
                    Shell Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26" data-path="find-and-replace-patterns.html">
            
                <a href="find-and-replace-patterns.html">
            
                    
                    Find and Replace Patterns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27" data-path="system-administration-commands.html">
            
                <a href="system-administration-commands.html">
            
                    
                    System Administration Commands
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Build Automation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="unix-programming-and-regular-expressions-workshop---build-automation">Unix Programming and Regular Expressions Workshop - Build Automation</h2>
<h2 id="sections">Sections:</h2>
<ul>
<li><a href="#description-of-build-automation">Description of Build Automation</a></li>
<li><a href="#list-of-build-automation-utilities">List of Build Automation Utilities</a></li>
<li><a href="#make-overview">Make Overview</a></li>
<li><a href="#makefile-overview">Makefile Overview</a></li>
<li><a href="#makefile-rules">Makefile Rules</a></li>
<li><a href="#makefile-macros">Makefile Macros</a></li>
<li><a href="#default-command">Default command</a></li>
<li><a href="#makefile-tasks">Makefile Tasks</a></li>
<li><a href="#including-other-makefiles">Including Other Makefiles</a></li>
<li><a href="#running-make-with-different-named-file">Running make with different named file</a></li>
<li><a href="#automatic-variables-and-wildcards">Automatic variables and Wildcards</a></li>
<li><a href="#phony-targets">Phony Targets</a></li>
<li><a href="#commands">Commands</a></li>
<li><a href="#make-options">Make Options</a></li>
<li><a href="#bread-crumb-navigation">Bread Crumb Navigation</a></li>
</ul>
<h4 id="description-of-build-automation">Description of Build Automation</h4>
<p><a href="https://en.wikipedia.org/wiki/Build_automation" target="_blank">Build Automation</a></p>
<blockquote>
<p>Build automation is the process of automating the creation of a software build and the associated processes including: compiling computer source code into binary code, packaging binary code, and running automated tests.</p>
</blockquote>
<p>Essentially build automation converts a set of files into a consumable software product.</p>
<p>Build automation is a prerequisite to effective use of continuous integration. </p>
<p>Benefits of Build Automation:</p>
<ul>
<li>Eliminates any variables in building software artifacts, thus reducing possible defects</li>
<li>Reduce the number of steps to get consummable software product thus reducing possible mistakes</li>
<li>Helps document target environments and/or dependenies on third party software</li>
</ul>
<p>Historically build automation occurred with makefiles and we will use makefiles for this build automation tutorial</p>
<h4 id="list-of-build-automation-utilities">List of Build Automation Utilities</h4>
<ul>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Overview.html#Overview" target="_blank">GNU Make</a></li>
<li><a href="https://ant.apache.org/manual/" target="_blank">Apache Ant for Java</a></li>
<li><a href="https://www.haskell.org/cabal/users-guide/" target="_blank">Cabal for haskell</a></li>
<li><a href="https://docs.npmjs.com/misc/scripts" target="_blank">npm scripts for Node based Projects</a></li>
<li><a href="https://en.wikipedia.org/wiki/Rake_%28software%29" target="_blank">Rake for Ruby</a></li>
<li><a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild" target="_blank">MSBuild for Windows Development</a></li>
</ul>
<p>There is many more build automation tooling this is just a short list I compiled</p>
<h4 id="make-overview">Make Overview</h4>
<p>Make is typically used to build executable programs and libraries from source code</p>
<p>Make is applicable to any process that involves executing arbitrary commands to transform a source file to a target result</p>
<p>The make utility automatically determines which pieces of a large program need to be recompiled, and issues commands to recompile them</p>
<p>Make will not help you build on multiple platforms however and so tools like <a href="https://www.gnu.org/software/autoconf/autoconf.html" target="_blank">Autoconf</a> and <a href="https://cmake.org/cmake/help/v3.10/manual/cmake.1.html" target="_blank">cmake</a> can further help you with this problem</p>
<p>This is because compilers can differ on different platforms like for example <a href="https://gcc.gnu.org/onlinedocs/gcc-7.2.0/gcc/" target="_blank">gnu gcc</a> can have different behavior to <a href="https://clang.llvm.org/get_started.html" target="_blank">apple clang compiler</a></p>
<p>Parts of a Makefile:</p>
<ul>
<li>Comment which start with <code>#</code></li>
<li>A variable assignment<ul>
<li><strong>Lazy Set</strong><ul>
<li><code>myvar = &apos;A Name&apos;</code></li>
<li>Normal setting of a variable - values within it are recursively expanded when the variable is used, not when it&apos;s declared</li>
</ul>
</li>
<li><strong>Immediate Set</strong><ul>
<li><code>myvar := &apos;Some Name&apos;</code></li>
<li>Setting of a variable with simple expansion of the values inside - values within it are expanded at declaration time.</li>
</ul>
</li>
<li><strong>Set If Absent</strong><ul>
<li><code>MyFoo ?= SomeBar</code></li>
<li>Setting of a variable only if it doesn&apos;t have a value</li>
</ul>
</li>
<li><strong>Append</strong><ul>
<li><code>anotherVar += &apos;another one bites the dust&apos;</code></li>
<li>Appending the supplied value to the existing value (or setting to that value if the variable didn&apos;t exist)</li>
</ul>
</li>
</ul>
</li>
<li>A Rule<ul>
<li><code>target: dependencies\n\tsystem command(s)</code></li>
<li>An explicit rule says when and how to remake one or more files, called the rule&apos;s targets.</li>
<li>It lists the other files that the targets depend on, called the prerequisites of the target, and may also give a recipe to use to create or update the targets.</li>
<li>An implicit rule says when and how to remake a class of files based on their names. </li>
<li>It describes how a target may depend on a file with a name similar to the target and gives a recipe to create or update such a target.</li>
</ul>
</li>
</ul>
<h4 id="makefile-overview">Makefile Overview</h4>
<p>The <a href="https://www.gnu.org/software/make/manual/html_node/Overview.html#Overview" target="_blank">make utility</a> will search in the current directory for a GNUmakefile, makefile, or Makefile files and will run specified or default targets from the <a href="https://en.wikipedia.org/wiki/Makefile" target="_blank">Makefile</a></p>
<p>Remember that earlier in the workshop we ran make without a makefile and the reason that worked is that make has some implicit rules that work as defaults unless you override them, therefore you can run make without a makefile</p>
<p>Read this <a href="https://stackoverflow.com/questions/15745241/using-the-make-command-without-makefiles" target="_blank">Stackoverflow Post</a> on running make without makefile for more details on this</p>
<p>A <strong>makefile</strong> consists of a set of rules</p>
<p>A rule begins with a textual dependency line which defines a target followed by a colon (:) and optionally an enumeration of components (files or other targets) on which the target depends.</p>
<pre><code class="lang-makefile"><span class="hljs-section">some_binary:</span>
    echo &quot;nothing&quot;
</code></pre>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example1; make
</code></pre>
<p>Notice here that when you run it you get the following output:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;nothing&quot;</span>
nothing
</code></pre>
<p>Because we specified the <strong>target</strong> <em>some_binary</em> first it is the <strong>default</strong> target</p>
<p>All it does is run the <strong>echo</strong> command. </p>
<p>Notice that it printed out the execution of the <code>echo &quot;nothing&quot;</code> and then it printed out <code>&quot;nothing&quot;</code></p>
<p>The exit status of make can be one of three values:</p>
<ul>
<li><p>0 </p>
<ul>
<li>The exit status is zero if make is successful.</li>
</ul>
</li>
<li><p>2</p>
<ul>
<li>The exit status is two if make encounters any errors. </li>
<li>It will print messages describing the particular errors.</li>
</ul>
</li>
<li><p>1</p>
<ul>
<li>The exit status is one if you use the &#x2018;-q&#x2019; flag and make determines that some target is not already up to date.</li>
</ul>
</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example2; make
</code></pre>
<p>Notice here that when we run <code>make</code> here we only get the output <strong>nothing</strong> instead.</p>
<p>We will discuss this further later but an at sign (@) will suppress output to standard output</p>
<h4 id="makefile-rules">Makefile Rules</h4>
<p>A makefile consists of rules.</p>
<p>The first command may appear on the same line after the prerequisites, separated by a semicolon</p>
<p><code>targets : prerequisites ; command</code></p>
<p>Here we defined a target with prereqs and command all in one line</p>
<pre><code class="lang-makefile">some_binary: ; @echo &quot;nothing&quot;
</code></pre>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example3; make
</code></pre>
<p>Here we get the same output except the target is run all in one line.</p>
<p>Notice that we had to put a semicolon <code>:</code> else we will get an error if we try to run <code>makefile</code> utility</p>
<p>Usually each rule has a single unique target, rather than multiple targets.</p>
<p>Make itself does not understand, recognize or distinguish different kinds of files</p>
<p>Each dependency line may be followed by a series of TAB indented command lines which define how to transform the components</p>
<p>If any of the prerequisites has a more recent modification time than the target, the command lines are run</p>
<p>Make decides where to start through <a href="https://en.wikipedia.org/wiki/Topological_sorting" target="_blank">Topological Sorting</a>.</p>
<p>A rule may have no command lines defined. </p>
<pre><code class="lang-makefile">target ... [target] : prerequisites ... [prerequisites]
</code></pre>
<p>This generic example illustrates that having multiple targets and prerequisites but no commands</p>
<h6 id="makefile-prefixes">Makefile Prefixes</h6>
<p>A makefile target can have one of three prefixes:</p>
<ul>
<li><p>a hyphen-minus (<code>-</code>), specifying that errors are ignored</p>
</li>
<li><p>an at sign (<code>@</code>), specifying that the command is not printed to standard output before it is executed.</p>
</li>
<li><p>a plus sign (<code>+</code>), the command is executed even if Make is invoked in a &quot;do not execute&quot; mode</p>
</li>
</ul>
<h6 id="makefile-definitions">Makefile Definitions</h6>
<p>A <strong>target</strong> is usually the name of a file that is generated by a program.
Examples of targets are executable or object files.
A target can also be the name of an action to carry out, such as &apos;clean&apos; (see Phony Targets).</p>
<p>A <strong>prerequisite</strong> is a file that is used as input to create the target. 
A target often depends on several files.</p>
<p>A <strong>recipe</strong> is an action that <code>make</code> carries out. 
A <strong>recipe</strong> may have more than one command, either on the same line or each on its own line. Please note: you need to put a tab character at the beginning of every recipe line! 
This is an obscurity that catches the unwary. 
If you prefer to prefix your recipes with a character other than tab, you can set the .RECIPEPREFIX variable to an alternate character.</p>
<pre><code class="lang-makefile"><span class="hljs-section">a_failure:</span>
echo &quot;Will not work&quot;
</code></pre>
<p>This makefile will not work</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example4; make
</code></pre>
<p>If you run this makefile in your terminal you will see the following error:</p>
<p><em>makefile:2: <em>*</em> missing separator.  Stop.</em></p>
<p>Usually a <strong>recipe</strong> is in a rule with prerequisites and serves to create a target file if any of the prerequisites change. 
However, the rule that specifies a recipe for the target need not have prerequisites. 
For example, the rule containing the delete command associated with the target &apos;clean&apos; does not have prerequisites.</p>
<p>A <strong>rule</strong>, then, explains how and when to remake certain files which are the targets of the particular rule. 
make carries out the recipe on the prerequisites to create or update the target. 
A rule can also explain how and when to carry out an action.</p>
<p>A makefile may contain other text besides rules, but a simple makefile need only contain rules. 
Rules may look somewhat more complicated than shown in this template, but all fit the pattern more or less.</p>
<h4 id="makefile-macros">Makefile Macros</h4>
<p>A makefile can contain definitions of macros. </p>
<p>Macros are usually referred to as variables when they hold simple string definitions, like &quot;CC=clang&quot;.</p>
<p>Macros in makefiles may be overridden in the command-line arguments passed to the Make utility. </p>
<p>Environment variables are also available as macros.</p>
<p>Macros allow users to specify the programs invoked and other custom behavior during the build process.</p>
<p>New macros (or simple &quot;variables&quot;) are traditionally defined using capital letters</p>
<p>A macro is used by expanding it</p>
<p>Traditionally this is done by enclosing its name inside <code>$()</code></p>
<p>An equivalent form uses curly braces rather than parenthesis, i.e. <code>${}</code></p>
<p>This is more common in BSD Unix flavors like Mac OS X.</p>
<pre><code class="lang-makefile">MY_NAME = &quot;Jean-Marcel&quot;

<span class="hljs-section">print_my_name:</span>
    @echo $(MY_NAME)
</code></pre>
<p>Notice here that we defined a <strong>macro</strong> named MY_NAME and used command prefix <code>@</code> to suppress output of <code>echo</code> command execution</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example5; make
</code></pre>
<p>You can see the output of the above makefile by running the snippet above</p>
<pre><code class="lang-makefile">MY_NAME = &quot;Jean-Marcel&quot;

<span class="hljs-section">print_my_name:</span>
    @echo ${MY_NAME}
</code></pre>
<p>Here we get the same output but used <code>${}</code> instead of <code>$()</code> to expand the makefile <strong>MACRO</strong></p>
<p>Macros can be composed of shell commands by using the command substitution operator, denoted by backticks (`).</p>
<p>Here is another example of shell commands:</p>
<pre><code class="lang-makefile">SOME_DATE = `date &quot;+DATE: %Y-%m-%d%nTIME: %H:%M:%S&quot;`

<span class="hljs-section">print_date_in_past:</span>
    @echo ${SOME_DATE}
</code></pre>
<p>In this example we can&apos;t use <code>$()</code> but need to use the ` ` instead</p>
<p>MACROS can be overriden in the commandline by doing the following:</p>
<p><code>make MACRO=&quot;value&quot; [MACRO=&quot;value&quot; ...] TARGET [TARGET ...]</code></p>
<pre><code class="lang-makefile">MY_NAME = &quot;Jean-Marcel Belmont&quot;

print my_name:
    @echo $(MY_NAME)
</code></pre>
<p>Here we defined the <em>MY_NAME</em> MACRO</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example9; make
</code></pre>
<p>Here we get the following output:</p>
<p><strong>Jean-Marcel Belmont</strong></p>
<p>If we however run make like this:</p>
<p>`make MY_NAME=&quot;John Rambo&quot;*</p>
<p>then the MY_NAME macro is overriden and the value <code>John Rambo</code> is printed to stdout instead</p>
<p>makefiles also have some predefined <strong>MACROS</strong> </p>
<p>You can find a complete list of MACROS <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html" target="_blank">HERE</a></p>
<p>You can also use environment variables as MACROS</p>
<pre><code class="lang-makefile"><span class="hljs-section">print_my_environment_variable:</span>
    @echo $$MY_VAR
</code></pre>
<p>Notice here that we had to access the environment variable with <code>$$</code> syntax.</p>
<p>The reason being is that each line of a makefile is parsed first using the makefile syntax, and then the result is passed to the shell so you have to wrap it in 2 <code>$</code> signs</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example10; <span class="hljs-built_in">export</span> MY_VAR=<span class="hljs-string">&quot;SOME VALUE&quot;</span>; make
</code></pre>
<p>When we run the following snippet from above we get the output <strong>SOME VALUE</strong> to stdout</p>
<h4 id="default-command">Default command</h4>
<pre><code class="lang-makefile">SOME_VAR := &quot;Hello there&quot;

<span class="hljs-comment"># Default target since it comes first</span>
<span class="hljs-section">all:</span>
    @echo $(SOME_VAR)


<span class="hljs-comment"># This target can be run with `make list`</span>
<span class="hljs-section">list:</span>
    @cd test; \
    ls
</code></pre>
<p>Notice here that we created a comment with <code>#</code> and that a default argument of <code>all</code> is created simply because it came first in the makefile</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> scripts/build-automation/example11; make
</code></pre>
<p>This will print out <strong>Hello there</strong></p>
<pre><code class="lang-bash">make list
</code></pre>
<p>This will <code>cd</code> into test directory and print out contents</p>
<h4 id="makefile-tasks">Makefile Tasks</h4>
<pre><code class="lang-makefile"><span class="hljs-comment"># Makefile with specific designed tasks</span>

all: program1 program2 program3

program1: program1.js
                    node program1.js

program2: program2.js
                    node program2.js

program3: program3.js
                    node program3.js
</code></pre>
<p>Notice here that we have specified 3 makefile tasks</p>
<p>The <code>all</code> task runs program1, program2, and program3 tasks respectively</p>
<p>The <code>all</code> task is the default task because it comes first in the <strong>Makefile</strong></p>
<p>In the program1 task here is the breakdown:</p>
<ul>
<li><code>program1.js</code> is given as a dependency</li>
<li>The command <code>node program1.js</code> is run</li>
</ul>
<p>For each of the tasks given to the default task of <code>all</code> this occurs</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/makefile-tasks; make
</code></pre>
<p>Notice that output of the 3 different program files when you run the command above.</p>
<h4 id="including-other-makefiles">Including Other Makefiles</h4>
<p>The include directive tells make to suspend reading the current makefile and read one or more other makefiles before continuing. </p>
<p>The directive is a line in the makefile that looks like this:</p>
<p><code>include somefile.mk</code></p>
<pre><code class="lang-makefile"><span class="hljs-comment"># Makefile with include directive</span>

all: program1 program2 program3 program4

program1: program1.js
                    node program1.js

program2: program2.js
                    node program2.js

program3: program3.js
                    node program3.js

include someprogram.mk
</code></pre>
<p>Notice the <code>include</code> directive in this makefile.</p>
<p>We also added program4 target to tasks in <code>all</code> target</p>
<h4 id="running-make-with-different-named-file">Running make with different named file</h4>
<p>The makefile can be given a different name than the 3 files:</p>
<ol>
<li>GNUmakefile</li>
<li>makefile</li>
<li>Makefile</li>
</ol>
<p>By using the commandline options: <code>-f</code>, <code>--file=file</code>, or <code>--makefile=FILE</code></p>
<p>Contents of <em>Node_Build_Script</em></p>
<pre><code class="lang-makefile"><span class="hljs-comment"># Another named makefile</span>
program2: program2.js
                    node program2.js
</code></pre>
<p>To run this file you can do the following:</p>
<ol>
<li><code>make -f Node_Build_Script</code></li>
<li><code>make --file=Node_Build_Script</code></li>
<li><code>make --makefile=Node_Build_Script</code></li>
</ol>
<h4 id="automatic-variables-and-wildcards">Automatic variables and Wildcards</h4>
<p><a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html" target="_blank">Automatic Variables</a></p>
<table>
<thead>
<tr>
<th>Automatic Variable</th>
<th>Computed Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>$@</td>
<td>The file name of the target of the rule. If the target is an archive member, then &#x2018;$@&#x2019; is the name of the archive file. In a pattern rule that has multiple targets (see Introduction to Pattern Rules), &apos;$@&apos; is the name of whichever target caused the rule&#x2019;s recipe to be run.</td>
</tr>
<tr>
<td>$%</td>
<td>The target member name, when the target is an archive member. See Archives. For example, if the target is foo.a(bar.o) then &apos;$%&apos; is bar.o and &apos;$@&apos; is foo.a. &apos;$%&apos; is empty when the target is not an archive member.</td>
</tr>
<tr>
<td>$&lt;</td>
<td>The name of the first prerequisite. If the target got its recipe from an implicit rule, this will be the first prerequisite added by the implicit rule (see Implicit Rules).</td>
</tr>
<tr>
<td>$?</td>
<td>he names of all the prerequisites that are newer than the target, with spaces between them. For prerequisites which are archive members, only the named member is used</td>
</tr>
<tr>
<td>$^</td>
<td>The names of all the prerequisites, with spaces between them. For prerequisites which are archive members, only the named member is used (see Archives). A target has only one prerequisite on each other file it depends on, no matter how many times each file is listed as a prerequisite. So if you list a prerequisite more than once for a target, the value of $^ contains just one copy of the name. This list does not contain any of the order-only prerequisites; for those see the &#x2018;$</td>
<td>&#x2019; variable, below.</td>
</tr>
<tr>
<td>$+</td>
<td>This is like &#x2018;$^&#x2019;, but prerequisites listed more than once are duplicated in the order they were listed in the makefile. This is primarily useful for use in linking commands where it is meaningful to repeat library file names in a particular order.</td>
</tr>
<tr>
<td>$\</td>
<td></td>
<td>The names of all the order-only prerequisites, with spaces between them.</td>
</tr>
<tr>
<td>$*</td>
<td>The stem with which an implicit rule matches (see How Patterns Match). If the target is dir/a.foo.b and the target pattern is a.%.b then the stem is dir/foo. The stem is useful for constructing names of related files. In a static pattern rule, the stem is part of the file name that matched the &#x2018;%&#x2019; in the target pattern.</td>
</tr>
</tbody>
</table>
<p>Some people refer to these automatic variables as wildcards in makefile</p>
<p>Let us look at a makefile for a golang project</p>
<pre><code class="lang-makefile"><span class="hljs-comment"># Variables</span>
BUILD_DIR := build
BUILD_MANIFEST := wildcard
BUILD_OUT := -o ${BUILD_DIR}/wildcard

<span class="hljs-comment"># Targets</span>
all: package files homedirectory

package:     compile
                    tar -czf ${BUILD_DIR}/wildcard.tar.gz -C ${BUILD_DIR} ${BUILD_MANIFEST}

compile:     wildcard.go
                    mkdir -p ${BUILD_DIR}
                    rm -rf ${BUILD_DIR}/*
                    go build ${BUILD_OUT}/wildcard

files:     *.go
                echo $?

homedirectory: ~
                echo $?

<span class="hljs-section">test:    </span>
                    go test ./...

<span class="hljs-section">clean:</span>
                    rm -rf ${BUILD_DIR}
</code></pre>
<p>Notice here that we have several targets and variables for this makefile.</p>
<p>We also used a couple of targets with wildcard operators <code>*</code>, and <code>~</code></p>
<p>Notice that <code>*.go</code> printed out all the go source files in current directory</p>
<p>Also notice that the <code>~</code> printed out current directory</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/wildcards; make
</code></pre>
<p>This will run the default target of all and its tasks</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/wildcards; make <span class="hljs-built_in">test</span>
</code></pre>
<p>This will run the go tests using the <code>test</code> target</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/wildcards; make clean
</code></pre>
<p>The <code>clean</code> target will run remove the build directory</p>
<p>Here we will look at another makefile that examines some more automatic variables</p>
<pre><code class="lang-makefile">goFiles := <span class="hljs-variable">$(wildcard *.go)</span>

showAutomaticVariables: automatic

automatic:     ${goFiles}
                        echo $@
                        echo $&lt;
                        echo $?
                        echo $^

<span class="hljs-section">clean:</span>
    rm ${goFiles}
</code></pre>
<p>Here we have a variable and several targets</p>
<p>To get this started run the following:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/makefile-automatic-variables; touch one.go second.go; touch third.go; make
</code></pre>
<p>You will see the following output:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">echo</span> automatic
automatic
<span class="hljs-built_in">echo</span> one.go
one.go
<span class="hljs-built_in">echo</span> one.go second.go third.go
one.go second.go third.go
<span class="hljs-built_in">echo</span> one.go second.go third.go
one.go second.go third.go
</code></pre>
<p>Here is the breakdown:</p>
<ul>
<li><code>echo $@</code> =&gt; prints out default target of automatic</li>
<li><code>echo $&lt;</code> =&gt; prints out first filed created of <code>one.go</code></li>
<li><code>echo $?</code> =&gt; prints outs all the prerequisites newer than the target which in this case is all the files</li>
<li><code>echo $^</code> =&gt; prints out all the prerequisites</li>
</ul>
<p>You can read about more <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html" target="_blank">Automatic Variables Here</a></p>
<h6 id="wildcard-functions-and-other-make-functions">Wildcard functions and other make functions</h6>
<p>The make utility has a <a href="https://www.gnu.org/software/make/manual/html_node/Wildcard-Function.html" target="_blank">WildCard Function</a>
 as well as more <a href="https://www.gnu.org/software/make/manual/html_node/Functions.html" target="_blank">functions</a></p>
<pre><code class="lang-makefile">src := <span class="hljs-variable">$(wildcard *.c)</span>

all: compile

compile:     ${src}
                    gcc ${src} -o printStuff
                    ./printStuff
</code></pre>
<p> Here I am using the wildcard function and notice that is wrapped in <code>$()</code> and we call the wildcard function which finds all the c source files in the current directory.</p>
<p> Then the default target of all call compile target which compiles source file into a binary executable called printStuff</p>
<p> Lastly <strong>printStuff</strong> binary is invoked and some statements are printed to stdout</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/makefile-wildcard-function; make
</code></pre>
<p>You can run the makefile by executing the command above in your terminal</p>
<h4 id="phony-targets">Phony Targets</h4>
<p>Suppose you have the following makefile:</p>
<pre><code class="lang-makefile">all: compile

compile:     one.o two.o three.o
                    gcc one.o two.o three.o

one.o :     one.c
                    gcc -c one.c

two.o :     two.c
                    gcc -c two.c

three.o : three.c
                    gcc -c three.c

<span class="hljs-section">clean:</span>
                    rm *.o
</code></pre>
<p>Here we have a list of targets that have object files as dependencies and then has a clean target that removes all of the object files</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/phony-target-issue; make; make clean
</code></pre>
<p>This works fine but suppose you do the following now:</p>
<pre><code class="lang-bash">touch clean
</code></pre>
<p>Now rerun <code>make clean</code> and look at the output:</p>
<p><strong>make: `clean&apos; is up to date.</strong></p>
<p>Notice that no matter what it reports clean is up to date </p>
<p>This is because you created a target file of clean and the make utility believes there is nothing left to do.</p>
<p>This is where the concept of the PHONY target comes into place</p>
<p>Let us look at this makefile now:</p>
<pre><code class="lang-makefile">all: compile

compile:     one.o two.o three.o
                    gcc one.o two.o three.o

one.o :     one.c
                    gcc -c one.c

two.o :     two.c
                    gcc -c two.c

three.o : three.c
                    gcc -c three.c

<span class="hljs-meta"><span class="hljs-meta-keyword">.PHONY</span>: clean</span>

<span class="hljs-section">clean:</span>
                    rm *.o
</code></pre>
<p>Notice now that we can run <code>make clean</code> and it works, it is because of the .PHONY target we just created which helps fix the issue of an existing file called the same name as the target</p>
<p>Let us now look at the previous makefile that had several targets specified:</p>
<pre><code class="lang-makefile"><span class="hljs-comment"># Variables</span>
BUILD_DIR := build
BUILD_MANIFEST := wildcard
BUILD_OUT := -o ${BUILD_DIR}/wildcard

<span class="hljs-comment"># Targets</span>
all: package files homedirectory

package:     compile
                    tar -czf ${BUILD_DIR}/wildcard.tar.gz -C ${BUILD_DIR} ${BUILD_MANIFEST}

compile:     wildcard.go
                    mkdir -p ${BUILD_DIR}
                    rm -rf ${BUILD_DIR}/*
                    go build ${BUILD_OUT}/wildcard

files:     *.go
                echo $?

homedirectory: ~
                echo $?

<span class="hljs-section">test:    </span>
                    go test ./...

<span class="hljs-meta"><span class="hljs-meta-keyword">.PHONY</span>: clean</span>

<span class="hljs-section">clean:</span>
                    rm -rf ${BUILD_DIR}
</code></pre>
<p>Here we created a .PHONY target for the clean task because clean should not be associated with a file</p>
<h4 id="commands">Commands</h4>
<p>Makefile commands help update targets</p>
<p>Remember that commands begin with a tab and follow the shell syntax</p>
<p><strong>Target : Prerequisite ; Command</strong></p>
<p>or in this format</p>
<pre><code class="lang-makefile">target: Prerequisites
TAB Command
TAB Command
....
</code></pre>
<p>The backslash character (<code>\</code>) is used to continue a command</p>
<pre><code class="lang-makefile">all: print

<span class="hljs-section">print: </span>
                @echo What is this \
stuff about
</code></pre>
<p>This is a trivial example but illustrates what the <code>\</code> is used for</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> ./scripts/build-automation/makefile-backslash-command; make
</code></pre>
<p>Run the command above to see the output</p>
<h4 id="make-options">Make Options</h4>
<p>Let us look at the following makefile:</p>
<pre><code class="lang-makefile">all: print

<span class="hljs-section">print: </span>
        echo one
        echo two
        echo three
</code></pre>
<p>If we run make like this <code>make -n</code> it will merely print the command but won&apos;t execute them</p>
<p><strong>Read the Fine Manual for more options with the make utility</strong></p>
<h4 id="bread-crumb-navigation">Bread Crumb Navigation</h4>
<hr>
<table>
<thead>
<tr>
<th style="text-align:left">Previous</th>
<th style="text-align:right">Next</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x2190; <a href="remote-file-sharing-and-file-access.html">Remote File Sharing and File Access</a></td>
<td style="text-align:right"><a href="building-command-line-applications.html">Building Command line applications</a> &#x2192;</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="remote-file-sharing-and-file-access.html" class="navigation navigation-prev " aria-label="Previous page: Remote File Sharing and File Access">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="building-command-line-applications.html" class="navigation navigation-next " aria-label="Next page: Building Command line applications">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Build Automation","level":"1.21","depth":1,"next":{"title":"Building Command line applications","level":"1.22","depth":1,"path":"docs/building-command-line-applications.md","ref":"docs/building-command-line-applications.md","articles":[]},"previous":{"title":"Remote File Sharing and File Access","level":"1.20","depth":1,"path":"docs/remote-file-sharing-and-file-access.md","ref":"docs/remote-file-sharing-and-file-access.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["include-codeblock","advanced-emoji","highlight","copy-code-button"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"copy-code-button":{},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"docs/build-automation.md","mtime":"2018-11-22T17:22:43.210Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-10T15:33:32.918Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

